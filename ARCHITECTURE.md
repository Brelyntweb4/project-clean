# ARCHITECTURE.md — Brelynt Electron (Web4, MVP)

---

## Общая архитектура

Brelynt Electron — это автономное десктопное приложение (PWA/Electron), работающее в локальной сети без доступа к интернету, с поддержкой защищённого P2P, кошелька и передачи файлов.

**Ядро** — это серверные модули на Node.js + web-интерфейс.

---

## Основные модули

* **main.js** — Главный управляющий процесс. Запускает P2P-сервер, кошелёк, соединяет backend и frontend, отслеживает логику приложения.

* **p2p-server.js** — Реализует P2P-обнаружение и обмен данными между узлами сети. Только по локальной сети. Использует WebSockets/Broadcast для поиска соседей.

* **blhub-server.js** — Файловый сервер: отвечает за пересылку файлов и сообщений между пользователями. Не выходит за пределы сети.

* **filehub.js / filehub-agent.js** — Модули локального хранения и агентов для обмена файлами/сообщениями через P2P.

* **public/p2p.js / p2pBridge.js** — Связующее звено между фронтендом и P2P-сервером. Передаёт события, заявки, транзакции, обработку баланса.

* **public/index.html / wallet.html** — Визуальный интерфейс. Через webview или браузер пользователь управляет кошельком, историей, отправляет/принимает токены и файлы.

* **buyToken.js / buyToken.css** — Модуль логики покупки/продажи токенов, стилизация интерфейса покупки (если включено).

* **start-services.sh / install-buy-module.ps1** — Скрипты запуска для Linux и Windows (автоматизируют старт сервисов).

---

## Хранение и безопасность

* Все приватные данные, ключи и история операций хранятся только на устройстве пользователя.
* Нет централизованных серверов, нет передачи приватных данных наружу.
* Кошельки и транзакции защищены шифрованием на стороне клиента.
* Баланс, история и внутренние идентификаторы — в локальном JSON-хранилище или файле.
* Нет взаимодействия с облаком или интернетом, даже при попытке подключения.

---

## Логика взаимодействия узлов

* При запуске каждый узел через P2P-сервер "заявляет о себе" по локальной сети (LAN/Wi-Fi).
* Другие устройства "видят" его и могут отправлять сообщения, токены, файлы.
* Все события проходят через P2P-модули, синхронизация истории — по запросу между доверенными устройствами.
* Пользователь может вручную выбрать, что расшаривать (токены, файлы, чаты и т.п.).

---

## Расширяемость

* Система построена модульно: любой компонент backend можно заменить, обновить, добавить новый сервис (чат, документы и т.п.).
* Для расширения архитектуры (например, добавления поддержки смартфонов) — подключается дополнительный серверный или webview-модуль.

---

## Диаграмма компонентов

```
[User] <-> [public/index.html] <-> [p2pBridge.js] <-> [main.js]
                                                    |         |
                                              [p2p-server.js] [filehub.js]
                                                    |         |
                                              [blhub-server.js][filehub-agent.js]
```

---

## Кратко (для Codex и сторонних разработчиков)

* Не менять существующий frontend, все доработки — только в backend и P2P-модулях.
* Любая новая бизнес-логика — отдельным модулем или в соответствующей backend-функции.
* Придерживаться офлайн-модели: никакой связи с внешними серверами.

---

**Документ составлен для поддержки разработки и интеграции модулей, а также для Codex/AI-помощников.**

