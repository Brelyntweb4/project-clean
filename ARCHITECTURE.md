# ARCHITECTURE.md — Web4 / Brelynt Electron

## Общая схема

```
Локальная сеть (LAN / Wi-Fi)
   ├─ ПК1 (узел)
   ├─ ПК2 (узел)
   ├─ ... (до 5 ПК)
   └─ Смартфоны (до 3 шт., webview / браузер)
```

**Каждое устройство** — это самостоятельный участник P2P-сети, который может:

* Обнаруживать другие устройства автоматически (LAN/Wi-Fi)
* Передавать и получать токены через свой кошелёк
* Обмениваться файлами (файловый обмен)
* Получать токены за предоставленные ресурсы (майнинг)
* Работать полностью офлайн, без серверов

---

## Основные компоненты

```
brelynt-electron/
├── public/
│   ├── index.html        # Интерфейс Web4/кошелька
│   ├── wallet.html       # Интерфейс кошелька (модуль)
│   ├── p2p.js            # P2P-логика (frontend)
│   ├── p2pBridge.js      # Связь между frontend и backend
├── main.js               # Точка входа Electron
├── blhub-server.js       # Логика кошелька, токены, баланс (backend)
├── filehub.js            # Файловый обмен (backend)
├── filehub-agent.js      # Служебные агенты для P2P-обмена
├── p2p-server.js         # P2P-соединение между узлами
├── preload.js            # Electron preload
├── start-services.sh     # Запуск сервисов (Linux/macOS)
├── install-buy-module.ps1# Сервисный скрипт (Windows)
```

---

## Логика взаимодействия

1. **Запуск приложения**

   * На ПК через Electron или браузер (index.html)
   * На смартфоне через браузер (webview) по Wi-Fi

2. **Обнаружение устройств**

   * Все узлы находят друг друга через локальную сеть автоматически (LAN discovery)

3. **P2P-коммуникация**

   * Токены, файлы и сообщения передаются напрямую между участниками, без центра

4. **Кошелёк**

   * Каждый участник получает свой уникальный ID, баланс, историю операций
   * Передача токенов между устройствами обновляет балансы обеих сторон

5. **Гуманитарный майнинг**

   * За выделенные ресурсы (память, вычисления) начисляются токены

6. **Безопасность**

   * Нет центральных серверов, все данные и история хранятся только на устройствах

---

## Расширение/масштабирование

* Для добавления нового устройства: скопируйте приложение, подключите к той же сети, всё заработает автоматически.
* Платформы: Windows, Linux (LiveUSB), Android/iOS (через webview).

---

## Особенности

* Frontend менять нельзя — только backend и бизнес-логику
* Офлайн-режим: всё работает без интернета
* Проект полностью пригоден для тестирования архитектуры Web4 в реальных условиях стенда (5 ПК + 3 смартфона)


## Общая концепция

**Brelynt Electron / Web4** — это минимальное ядро тестового автономного интернета нового поколения.
Каждое устройство (ПК или смартфон) становится полноценным узлом собственной автономной сети.
Система рассчитана на работу полностью **офлайн**, не требует облаков или внешних серверов, и в тестовой версии разворачивается на лабораторной сети из 5 ПК и 3 смартфонов.

---

## Тестовая лабораторная сеть

> **Внимание!**
> Данная версия предназначена для тестирования и прототипирования.
> В лабораторной среде участвуют **5 компьютеров** и **3 смартфона** (можно больше, это минимальный стенд).
> **Web4 — не ограничен этим количеством устройств:** в реальном развертывании количество и типы устройств не лимитированы.

---

## Интерфейс Web4: запуск на разных устройствах

* **ПК:** Запуск через Electron-приложение (`public/index.html`) либо напрямую из браузера.
* **Смартфоны:** Подключение по локальной сети через браузер (`http://<IP_PC>:3040/mobile/`) либо в перспективе — через адаптированное мобильное приложение.
* **“Интернет поверх интернета”:**
  Архитектура допускает запуск через альтернативный DNS или внутренние домены, что позволяет использовать Web4 и внутри классического браузера, и как отдельное автономное приложение.

**Везде используется единый интерфейс** — файл `public/index.html`.
Именно он открывает вход в Web4 на всех платформах.

---

## Краткое описание архитектуры

* **Frontend (public):**

  * `index.html` — основной интерфейс кошелька, главная точка входа
  * `wallet.html` — страница управления кошельком
  * `p2p.js`, `p2pBridge.js` — логика P2P-обмена и связи интерфейса с backend
* **Backend (корень brelynt-electron):**

  * `main.js` — точка входа для Electron
  * `blhub-server.js` — обработка токенов и кошельков
  * `filehub.js`, `filehub-agent.js` — P2P-обмен файлами
  * `p2p-server.js` — P2P-соединения и обнаружение других узлов
  * `preload.js` — Electron preload
* **Скрипты запуска:**

  * `start-services.sh` — для Linux/macOS
  * `install-buy-module.ps1` — для Windows

---

## Принципы работы

* Каждый узел в сети равноправный (нет “главного сервера”)
* Обнаружение и объединение устройств — автоматически по LAN/Wi-Fi, без облаков
* Все действия (баланс, история, транзакции, обмен файлами) фиксируются и хранятся локально
* Все транзакции подписываются и подтверждаются на каждом устройстве
* Выход любого устройства не нарушает работу остальных
* Новое устройство запускается простым копированием папки приложения
* Баланс, история, настройки не уходят за пределы вашего устройства

---

## Архитектура взаимодействия

* **Frontend** через JS обращается к backend через p2pBridge.js (локально или по локальной сети)
* **Backend** обеспечивает:

  * Обнаружение новых устройств
  * Ведение баланса и историю транзакций
  * P2P-обмен файлами и сообщениями
  * Локальное хранение и резервное копирование
  * Безопасную подпись и валидацию транзакций (никакие приватные данные не покидают устройство)
* **Масштабирование:**
  Для увеличения сети просто копируйте приложение на новые ПК или смартфоны.

---

## Задание для Codex и разработчиков

* **Frontend (папка public) не трогать и не изменять**
* Все доработки и бизнес-логика — только в backend
* Реализовать:

  * Автоматическое P2P-обнаружение и объединение устройств (LAN/Wi-Fi)
  * Реальный кошелёк (уникальный ID, реальный баланс, история)
  * Передачу токенов с фиксацией на обоих концах (локально)
  * Локальное хранение истории, автоматическое резервирование
  * Офлайн-режим, категорически без облаков и серверов
  * Возможность расширения (майнинг, обмен файлами, новые сервисы)
* Архитектурные решения — документировать, весь backend комментировать

---

## Пояснения для тестовой лаборатории

* Эта сборка — **прототип лабораторного стенда** (5 ПК + 3 смартфона), созданного для демонстрации и отработки концепции Web4.
* В реальном Web4 таких стендов и устройств будет сколько угодно.
* Смартфоны равноправны с ПК: участвуют в хранении, вычислениях, обмене ресурсами.
* Возможна адаптация интерфейса и под другие платформы.
* Новые устройства — это просто новые узлы, нет ограничений на масштаб.

---

